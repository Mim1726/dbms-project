<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voting Button Test</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/voting.js"></script>
    <script src="js/auth.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { padding: 10px 15px; margin: 5px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background: white; margin: 50px auto; padding: 20px; max-width: 600px; border-radius: 8px; max-height: 80vh; overflow-y: auto; }
        .close { float: right; font-size: 28px; cursor: pointer; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-outline { background: white; color: #007bff; border: 1px solid #007bff; }
        .voting-candidate { margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .voting-candidate.selected { background: #e3f2fd; border-color: #2196f3; }
        .candidate-card-voting { display: block; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Voting Button Test</h1>
    
    <div class="test-section">
        <h2>Test Mock User Login</h2>
        <button onclick="mockLogin()">Mock Login as Voter</button>
        <div id="auth-status"></div>
    </div>

    <div class="test-section">
        <h2>Test Voting Process</h2>
        <button onclick="testVoting()">Start Voting Process</button>
        <div id="voting-status"></div>
    </div>

    <!-- Voting Modal -->
    <div id="votingModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="document.getElementById('votingModal').style.display='none'">&times;</span>
            <div id="votingContent">
                <!-- Voting content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Mock authentication for testing
        function mockLogin() {
            // Create a mock Auth object
            if (!window.Auth) {
                window.Auth = {
                    currentUser: {
                        email: 'john@example.com',
                        full_name: 'John Doe'
                    },
                    userRole: 'voter',
                    isAuthenticated: () => true,
                    hasRole: (role) => role === 'voter',
                    getCurrentUser: () => ({
                        email: 'john@example.com',
                        full_name: 'John Doe'
                    })
                };
            }
            document.getElementById('auth-status').innerHTML = '<div style="color: green;">✓ Logged in as John Doe (Voter)</div>';
        }

        async function testVoting() {
            if (!window.Auth || !window.Auth.isAuthenticated()) {
                document.getElementById('voting-status').innerHTML = '<div style="color: red;">✗ Please login first</div>';
                return;
            }

            document.getElementById('voting-status').innerHTML = '<div>Starting voting process...</div>';

            try {
                // Test with election ID 301 (from sample data)
                await window.Voting.startVoting('301');
                document.getElementById('voting-status').innerHTML = '<div style="color: green;">✓ Voting modal should have opened</div>';
            } catch (error) {
                document.getElementById('voting-status').innerHTML = `<div style="color: red;">✗ Error: ${error.message}</div>`;
                console.error('Voting test error:', error);
            }
        }

        // Initialize voting when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            if (!window.Voting) {
                console.log('Voting class not found, creating instance...');
                window.Voting = new Voting();
            }
            
            // Mock Utils if not available
            if (!window.Utils) {
                window.Utils = {
                    showLoading: () => console.log('Loading...'),
                    hideLoading: () => console.log('Loading hidden'),
                    showToast: (msg, type) => console.log(`Toast (${type}): ${msg}`),
                    sanitizeHtml: (str) => str,
                    formatDate: (date) => new Date(date).toLocaleDateString()
                };
            }
        });
    </script>
</body>
</html>

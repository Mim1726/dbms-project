<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Election Status Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .election-card {
            border: 2px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
        }
        .election-card.upcoming {
            border-color: #2196F3;
            background-color: #E3F2FD;
        }
        .election-card.active {
            border-color: #4CAF50;
            background-color: #E8F5E8;
        }
        .election-card.ended {
            border-color: #F44336;
            background-color: #FFEBEE;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }
        .status-upcoming { background-color: #2196F3; }
        .status-active { background-color: #4CAF50; }
        .status-ended { background-color: #F44336; }
        .date-info {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Election Status Verification</h1>
    <p><strong>Current Date (Simulated):</strong> September 4, 2025 at 12:00 PM</p>
    <p><strong>Expected Results:</strong></p>
    <ul>
        <li>Women Leadership Poll → <strong>Upcoming</strong> (voting starts Nov 5)</li>
        <li>City Council Election → <strong>Upcoming</strong> (voting starts Oct 10)</li>
        <li>Mayor Election → <strong>Active</strong> (voting ongoing Sep 1-5)</li>
    </ul>

    <div class="test-results" id="testResults"></div>

    <script>
        // Test data matching the database structure
        const elections = [
            {
                election_id: 305,
                name: "Women Leadership Poll",
                title: "Women Leadership Poll",
                description: "Empowering women leaders",
                election_date: "2025-11-10",
                election_type: "Special",
                is_active: "Y",
                schedule: [{
                    voting_start: "2025-11-05T08:00:00",
                    voting_end: "2025-11-10T18:00:00",
                    nomination_start: "2025-08-15T00:00:00",
                    nomination_end: "2025-08-25T23:59:59"
                }]
            },
            {
                election_id: 302,
                name: "City Council Election",
                title: "City Council Election", 
                description: "City-level election",
                election_date: "2025-10-15",
                election_type: "Local",
                is_active: "Y",
                schedule: [{
                    voting_start: "2025-10-10T08:00:00",
                    voting_end: "2025-10-15T18:00:00",
                    nomination_start: "2025-08-01T00:00:00",
                    nomination_end: "2025-08-10T23:59:59"
                }]
            },
            {
                election_id: 304,
                name: "Mayor Election",
                title: "Mayor Election",
                description: "Local Mayor election",
                election_date: "2025-09-05", 
                election_type: "Local",
                is_active: "N",
                schedule: [{
                    voting_start: "2025-09-01T08:00:00",
                    voting_end: "2025-09-05T18:00:00",
                    nomination_start: "2025-08-01T00:00:00",
                    nomination_end: "2025-08-05T23:59:59"
                }]
            }
        ];

        // Fixed election status function
        function getElectionStatus(election) {
            // Simulate September 4, 2025 12:00 PM
            const now = new Date('2025-09-04T12:00:00');
            
            // Check if election has a schedule first (most reliable)
            if (election.schedule && election.schedule.length > 0) {
                const schedule = election.schedule[0];
                const votingStart = schedule.voting_start ? new Date(schedule.voting_start) : null;
                const votingEnd = schedule.voting_end ? new Date(schedule.voting_end) : null;
                
                if (votingStart && votingEnd) {
                    // Use schedule for status determination
                    if (now > votingEnd) {
                        return 'Ended';
                    } else if (now >= votingStart && now <= votingEnd) {
                        return 'Active';
                    } else if (now < votingStart) {
                        return 'Upcoming';
                    }
                }
            }
            
            // Fallback to election_date comparison only if no schedule
            const electionDate = new Date(election.election_date);
            
            // Always prefer future dates as upcoming when no schedule is available
            if (electionDate >= now) {
                return 'Upcoming';
            } else {
                // Past election - check how far in the past
                const daysDiff = (now - electionDate) / (1000 * 60 * 60 * 24);
                
                if (daysDiff > 1) {
                    return 'Ended';
                } else {
                    // Election was today or yesterday - check if still active
                    return election.is_active === 'Y' ? 'Active' : 'Ended';
                }
            }
        }

        // Test and display results
        const resultsContainer = document.getElementById('testResults');
        
        elections.forEach(election => {
            const status = getElectionStatus(election);
            const schedule = election.schedule[0];
            
            const card = document.createElement('div');
            card.className = `election-card ${status.toLowerCase()}`;
            
            card.innerHTML = `
                <div class="status-badge status-${status.toLowerCase()}">${status}</div>
                <h3>${election.name}</h3>
                <p>${election.description}</p>
                
                <div class="date-info">
                    <strong>Election Date:</strong> ${new Date(election.election_date).toLocaleDateString()}<br>
                    <strong>Voting Period:</strong> ${new Date(schedule.voting_start).toLocaleString()} 
                    to ${new Date(schedule.voting_end).toLocaleString()}<br>
                    <strong>Type:</strong> ${election.election_type}<br>
                    <strong>Is Active Flag:</strong> ${election.is_active}
                </div>
            `;
            
            resultsContainer.appendChild(card);
        });
    </script>
</body>
</html>
